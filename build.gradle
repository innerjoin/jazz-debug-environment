apply plugin: 'java'

import org.gradle.internal.os.OperatingSystem;

task detect {
    doLast {
        println("Linux: " + OperatingSystem.current().isLinux())
        println("Windows: " + OperatingSystem.current().isWindows())
    }
}

task cleanup(type: Exec) {
    group "Jetty"
    description "Delete generated and runtime files"
    if (OperatingSystem.current().isWindows()) {
        workingDir './'
        commandLine 'powershell.exe', './scripts/clean.ps1'
    }

    if (OperatingSystem.current().isLinux()) {
        workingDir './'
        commandLine './clean.sh'
    }
}

task generate(type: Exec) {
    group "Jetty"
    description "Create jazz and equinox configuration files"
    if (OperatingSystem.current().isWindows()) {
        workingDir 'conf/jetty'
        commandLine 'powershell.exe', '../../scripts/generate_jetty_config.ps1'
    }

    if (OperatingSystem.current().isLinux()) {
        workingDir './conf/jetty'
        commandLine './generate_jetty_config.sh'
        ignoreExitValue true
    }
}

task run(type: Exec) {
    group "Jetty"
    description "Start jazz server"
    if (OperatingSystem.current().isWindows()) {
        workingDir './'
        commandLine 'cmd', '/K', 'start', 'powershell','./scripts/run_jetty.ps1'
    }

    if (OperatingSystem.current().isLinux()) {
    }

}
